[toc]

内容参考：

1. [GeeksforGeeks](https://www.geeksforgeeks.org/compiling-a-c-program-behind-the-scenes/?ref=lbp)

<br>

## **编译**

<br>

编译，是将代码从源代码转变为机器码的过程。*C* 程序的编译，就是将用 *C* 语言写下来的源代码，编译为机器可执行的机器码的过程。

那为什么需要编译这一步呢？

最粗暴的理由就是，不编译你的代码无法执行。好比机器是一个不懂中文的法国人，你写了一篇中文文章给他让他念，他能念？所以就需要一个翻译人，将你的中文翻译为法语再让机器念。

机器懂的语言比法语简单的多——二进制语言。因此整个编译，就是一个从 *C* 语言翻译为二进制的过程。而这个翻译器，专业称呼为编译器，编译器能念懂的文件，专业称呼是可执行文件。

<br>

## **实现编译**

<br>

不借助 *IDE* 环境，如何实现编译？在 *Linux* 中需要下载编译器，编译器名字为 *GCC* 。然后借助 *GCC* 来实现编译，生成机器可执行文件。

1. 生成 *C* 源文件

    ```C
    $ vim filename.c
    ```

2. 编译

    ```c
    $ gcc filename.c -o filename
    ```

3. 执行程序
    
    ```c
    $ ./filename
    ```

<br>

## **编译的过程**

<br>

编译总共有四个过程：预处理 -> 编译 -> 汇编 -> 链接。文件转变：filename.i -> filename.s -> filename.o -> filename

<center>

![Compilation Process in C](https://github.com/WBlackhole/CS50_note/blob/master/pic/Compilation-Process-in-C.png?raw=true "C的编译过程")

</center>

<br>

#### **1. 预处理**
    
预处理这一步主要实现：

1. **删除评论**

2. **宏扩展**：将代码中出现的宏按照程序定义进行替换。

3. **头文件扩展**：将头文件里面的所有内容，也就是将头文件中所有的函数声明以及变量声明，添加到文件中。这一步相当于复制粘贴头文件。

4. **条件编译**：未懂待续。


<br>

#### **2. 编译**

编译这一步实现了将 *C* 语言代码转变为汇编语言代码。

<br>

#### **3. 汇编**

汇编这一步实现了将汇编代码转变为机器码，但是保留了函数原型，函数扩展在第四步完成。

<br>

#### **4. 链接**

连接这一步实现了函数原型的扩展。例如代码中出现的 *printf* 函数，它的定义在另一个文件，也就是库文件中。而这一步实现的就是将 *printf* 的定义从库函数文件中链接至当前文件中，最后生成可执行文件。
